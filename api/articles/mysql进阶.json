{"title":"mysql进阶","uid":"eb843316efe7fc0d2e0c7904a0ae2582","slug":"mysql进阶","date":"2024-12-03T12:56:15.000Z","updated":"2024-12-03T13:28:34.560Z","comments":true,"path":"api/articles/mysql进阶.json","keywords":null,"cover":"https://i.pinimg.com/474x/5a/ac/72/5aac72b9968dd13d3c7ee22dd6175b2f.jpg","content":"<h2 id=\"MySQL的系统架构\"><a href=\"#MySQL的系统架构\" class=\"headerlink\" title=\"MySQL的系统架构\"></a><a href=\"#mysql%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84\">MySQL的系统架构</a></h2><h4 id=\"1、数据库和数据库实例\"><a href=\"#1、数据库和数据库实例\" class=\"headerlink\" title=\"1、数据库和数据库实例\"></a><a href=\"#_1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B\">1、数据库和数据库实例</a></h4><p>在与MySQL相关的学习和研究中，我们需要搞清楚一些概念：</p>\n<ul>\n<li>数据库：按照一定的数据结构来组织、存储和管理数据的仓库，通常由数据库管理系统进行管理。</li>\n<li>数据库管理软件（RDBMS）：就是我们说的数据库管理软件，我们常说的MySQL指的就是它。</li>\n<li>数据库实例：其实就是正在运行的数据库管理程序，一个数据库管理程序我们称作一个数据库实例。</li>\n</ul>\n<h4 id=\"2、MySQL架构\"><a href=\"#2、MySQL架构\" class=\"headerlink\" title=\"2、MySQL架构\"></a><a href=\"#_2%E3%80%81mysql%E6%9E%B6%E6%9E%84\">2、MySQL架构</a></h4><p><img src=\"https://www.kaiven666.online/images/image-20241105214939864.png\" alt=\"image-20241105214939864\"></p>\n<p>（现在的话，有个印象就行了）</p>\n<h6 id=\"（1）MySQL向外提供的交互接口\"><a href=\"#（1）MySQL向外提供的交互接口\" class=\"headerlink\" title=\"（1）MySQL向外提供的交互接口\"></a><a href=\"#_1-mysql%E5%90%91%E5%A4%96%E6%8F%90%E4%BE%9B%E7%9A%84%E4%BA%A4%E4%BA%92%E6%8E%A5%E5%8F%A3\">（1）MySQL向外提供的交互接口</a></h6><p>Connectors组件，是MySQL向外提供的交互组件，如java,.net,php等语言可以通过该组件来操作SQL语句，实现</p>\n<p>与SQL的交互。通过客户端&#x2F;服务器通信协议与MySQL建立连接。MySQL 客户端与服务端的通信方式是 “ 半双工</p>\n<p>”。对于每一个 MySQL 的连接，时刻都有一个线程状态来标识这个连接正在做什么。</p>\n<h6 id=\"（2）管理服务组件和工具组件\"><a href=\"#（2）管理服务组件和工具组件\" class=\"headerlink\" title=\"（2）管理服务组件和工具组件\"></a><a href=\"#_2-%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6%E5%92%8C%E5%B7%A5%E5%85%B7%E7%BB%84%E4%BB%B6\">（2）管理服务组件和工具组件</a></h6><p>提供MySQL的各项服务组件和管理工具，如备份(Backup)，恢复(Recovery)，安全管理(Security)等功能。</p>\n<h6 id=\"（3）连接池组件\"><a href=\"#（3）连接池组件\" class=\"headerlink\" title=\"（3）连接池组件\"></a><a href=\"#_3-%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%BB%84%E4%BB%B6\">（3）连接池组件</a></h6><p>负责监听客户端向MySQL Server端的各种请求，接收请求，转发请求到目标模块。每个成功连接MySQL Server的客户请求都会被创建或分配一个线程，该线程负责客户端与MySQL Server端的通信，接收客户端发送的命令，传递服务端的结果信息等。</p>\n<h6 id=\"（4）SQL接口组件\"><a href=\"#（4）SQL接口组件\" class=\"headerlink\" title=\"（4）SQL接口组件\"></a><a href=\"#_4-sql%E6%8E%A5%E5%8F%A3%E7%BB%84%E4%BB%B6\">（4）SQL接口组件</a></h6><p>接收用户SQL命令，如DML,DDL和存储过程等，并将最终结果返回给用户。</p>\n<h6 id=\"（5）查询分析器组件\"><a href=\"#（5）查询分析器组件\" class=\"headerlink\" title=\"（5）查询分析器组件\"></a><a href=\"#_5-%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90%E5%99%A8%E7%BB%84%E4%BB%B6\">（5）查询分析器组件</a></h6><p>首先分析SQL命令语法的合法性，并进行抽象语法树解析，如果sql有语法错误，会抛出异常信息。</p>\n<h6 id=\"（6）优化器组件\"><a href=\"#（6）优化器组件\" class=\"headerlink\" title=\"（6）优化器组件\"></a><a href=\"#_6-%E4%BC%98%E5%8C%96%E5%99%A8%E7%BB%84%E4%BB%B6\">（6）优化器组件</a></h6><p>对SQL命令按照标准流程进行优化分析，mysql会按照它认为的最优方式进行优化，选用成本最小的执行计划。</p>\n<h6 id=\"（7）缓存组件\"><a href=\"#（7）缓存组件\" class=\"headerlink\" title=\"（7）缓存组件\"></a><a href=\"#_7-%E7%BC%93%E5%AD%98%E7%BB%84%E4%BB%B6\">（7）缓存组件</a></h6><p>缓存和缓冲组件，这里边的内容我们后边会详细的讲解。</p>\n<h6 id=\"（8）MySQL存储引擎\"><a href=\"#（8）MySQL存储引擎\" class=\"headerlink\" title=\"（8）MySQL存储引擎\"></a><a href=\"#_8-mysql%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E\">（8）MySQL存储引擎</a></h6><p>MySQL属于关系型数据库，而关系型数据库的存储是以表的形式进行的，对于表的创建，数据的存储，检索，更新等都是由MySQL存储引擎完成的。</p>\n<p>MySQL存储引擎在MySQL中扮演着重要角色。研究过SQL Server和Oracle的读者可能很清楚，这两种数据库的存</p>\n<p>储引擎只有一个，而MySQL的存储引擎种类比较多，如MyIsam存储引擎，InnoDB存储引擎和Memory存储引</p>\n<p>擎。</p>\n<p>因为mysql本身就是开源的，他允许第三方基于MySQL骨架，开发适合自己业务需求的存储引擎。从MySQL存储引擎种类上来说，可以分为官方存储引擎和第三方存储引擎，比较常用的存储引擎包括InnoDB存储引擎，MyIsam 存储引擎和Momery存储引擎。</p>\n<h4 id=\"3、SQL语句的执行流程\"><a href=\"#3、SQL语句的执行流程\" class=\"headerlink\" title=\"3、SQL语句的执行流程\"></a><a href=\"#_3%E3%80%81sql%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\">3、SQL语句的执行流程</a></h4><p><img src=\"https://www.kaiven666.online/images/image-20241105215947264.png\" alt=\"image-20241105215947264\"></p>\n<p>（图应该都可以看得懂的吧）</p>\n<h6 id=\"小问题：MySQL8为什么取消了查询缓存？\"><a href=\"#小问题：MySQL8为什么取消了查询缓存？\" class=\"headerlink\" title=\"小问题：MySQL8为什么取消了查询缓存？\"></a><a href=\"#%E5%B0%8F%E9%97%AE%E9%A2%98-mysql8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E6%B6%88%E4%BA%86%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98\">小问题：MySQL8为什么取消了查询缓存？</a></h6><ol>\n<li><strong>锁争用问题</strong>：在高并发环境中，查询缓存会引起锁争用问题。每次对查询缓存的读写操作都需要获取锁，这在高并发下会导致锁的争用，进而引发性能瓶颈。</li>\n<li><strong>缓存无效化问题</strong>：查询缓存的无效化机制导致缓存命中率较低。当一个表的数据发生变化时（如INSERT、UPDATE、DELETE操作），与该表相关的所有查询缓存都会被无效化。对于写操作频繁的系统，这意味着查询缓存的有效性非常短暂，导致缓存命中率很低，反而增加了缓存维护的开销而没有带来明显的性能提升。</li>\n<li><strong>内存开销</strong>：查询缓存的管理需要额外的内存资源，而且如果查询语句的字符大小写、空格或者注释的不同，查询缓存都会认为是不同的查询（因为他们的hash值会不同），这可能会导致内存资源的过度消耗。</li>\n</ol>\n<h2 id=\"MySQL的目录结构\"><a href=\"#MySQL的目录结构\" class=\"headerlink\" title=\"MySQL的目录结构\"></a><a href=\"#mysql%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\">MySQL的目录结构</a></h2><h4 id=\"windows中的目录结构\"><a href=\"#windows中的目录结构\" class=\"headerlink\" title=\"windows中的目录结构\"></a><a href=\"#windows%E4%B8%AD%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\">windows中的目录结构</a></h4><p>在mysql启动的时候，会从【安装目录】加载软件数据，在运行过程中，会从【数据目录】中读取数据。这两个目</p>\n<p>录我们不要放在一起，避免重新安装软件导致数据丢失：</p>\n<p><img src=\"https://www.kaiven666.online/images/image-20241105220917711.png\" alt=\"image-20241105220917711\"></p>\n<ul>\n<li><strong>bin目录</strong>：用于放置一些可执行的工具文件，如mysql.exe、mysqld.exe、mysqlshow.exe等。</li>\n<li><strong>include目录</strong>：用于放置一些头文件，如：mysql.h、mysql_ername.h等。（MySQL是C语言写的，这个都知道的吧）</li>\n<li><strong>lib目录</strong>：用于放置一系列库文件。</li>\n<li><strong>data目录</strong>：用于放置一些日志文件以及数据库。</li>\n<li><strong>my.ini文件</strong>：MySQL的配置文件，MySQL实例初始化时会加载该文件中的内容</li>\n</ul>\n<p><img src=\"https://www.kaiven666.online/images/image-20241105221524581.png\" alt=\"image-20241105221524581\"></p>\n<p>data目录中，每个文件夹对应一个数据库，数据库中的表就是一个又一个的文件。</p>\n<h4 id=\"Linux中的文件目录\"><a href=\"#Linux中的文件目录\" class=\"headerlink\" title=\"Linux中的文件目录\"></a><a href=\"#linux%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95\">Linux中的文件目录</a></h4><p>这个和windows下的文件目录是差不多的，如果是默认的安装方式的话，文件是分散在不同地方的。</p>\n<p>（百度或者问AI）</p>\n<h2 id=\"字符集和排序规则\"><a href=\"#字符集和排序规则\" class=\"headerlink\" title=\"字符集和排序规则\"></a><a href=\"#%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99\">字符集和排序规则</a></h2><p>mysql支持大量的字符集，但是我们通常使用的是utf8，【show collation】命令可以查看mysql支持的所有的排序规则和字符集，如下所示部分：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show collation like &#x27;%utf8%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.kaiven666.online/images/image-20241105222600869.png\" alt=\"image-20241105222600869\"></p>\n<p>一种字符集会对应很多的规则：</p>\n<ul>\n<li><p>utf8-polish-ci，表示utf-8的字符集的波兰语的比较规则，ci代表忽略大小写。</p>\n</li>\n<li><p>utf8-general-ci，就是通用的忽略大小写的utf8字符集比较规则。</p>\n</li>\n<li><p>utf8mb4_0900_ai_ci中的0900指的是Unicode 9.0的规范，后边的后缀代表不区分重音也不区分大小写，他是utf8mb4字符集一个新的通用排序归则。</p>\n</li>\n</ul>\n<p><img src=\"https://www.kaiven666.online/images/image-20241105222747423.png\" alt=\"image-20241105222747423\"></p>\n<p>utf8和utf8mb4的区别：</p>\n<ul>\n<li><p>utf8mb3(utf-8)：使用1~3个字节表示字符，utf8默认就是utf8mb3。</p>\n</li>\n<li><p>utf8mb4：使用1~4个字节表示字符，他是utf8的超集，甚至可以存储很多【emoji表情?????】，</p>\n</li>\n<li><p>mysql8.0已经默认字符集设置为utf8mb4。</p>\n</li>\n</ul>\n<p>【字符集】和【比较规则】可以作用在全局、数据库、表、甚至是列级别。（想了解的自行百度怎么设置，大家最熟悉的莫过于在创建库和表的时候指定字符集和比较规则吧）</p>\n<h2 id=\"MySQL修改配置的方法\"><a href=\"#MySQL修改配置的方法\" class=\"headerlink\" title=\"MySQL修改配置的方法\"></a><a href=\"#mysql%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95\">MySQL修改配置的方法</a></h2><h4 id=\"1、修改全局变量\"><a href=\"#1、修改全局变量\" class=\"headerlink\" title=\"1、修改全局变量\"></a><a href=\"#_1%E3%80%81%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F\">1、修改全局变量</a></h4><p>很显然，这些东西你百度都能得到的，这里就不去复制粘贴了。全局修改的变量对每一个会话都起作用。</p>\n<h4 id=\"2、当前会话的变量\"><a href=\"#2、当前会话的变量\" class=\"headerlink\" title=\"2、当前会话的变量\"></a><a href=\"#_2%E3%80%81%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D%E7%9A%84%E5%8F%98%E9%87%8F\">2、当前会话的变量</a></h4><p>这个修改的作用域只对某一个会话起作用。</p>\n<h4 id=\"3、修改配置文件\"><a href=\"#3、修改配置文件\" class=\"headerlink\" title=\"3、修改配置文件\"></a><a href=\"#_3%E3%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">3、修改配置文件</a></h4><p>先看一个示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\"></span><br><span class=\"line\">port = 3306</span><br><span class=\"line\"></span><br><span class=\"line\">socket = /tmp/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\"></span><br><span class=\"line\">port = 3306</span><br><span class=\"line\"></span><br><span class=\"line\">basedir = /project/mysql/mysql-8.0.18</span><br><span class=\"line\"></span><br><span class=\"line\">datadir = /project/mysql/data</span><br><span class=\"line\"></span><br><span class=\"line\">pid-file = /project/mysql/mysql-8.0.18/mysqld.pid</span><br><span class=\"line\"></span><br><span class=\"line\">socket = /tmp/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">tmpdir = /project/mysql/tmp</span><br><span class=\"line\"></span><br><span class=\"line\">user = mysql</span><br><span class=\"line\"></span><br><span class=\"line\">#关闭MySQL X plugin（33060）</span><br><span class=\"line\"></span><br><span class=\"line\">mysqlx=0</span><br><span class=\"line\"></span><br><span class=\"line\">###日志配置------</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_log_file_size = 1G</span><br><span class=\"line\"></span><br><span class=\"line\">log_error = /project/mysql/mysql-8.0.18/log/error.log</span><br><span class=\"line\"></span><br><span class=\"line\">slow_query_log = 1</span><br><span class=\"line\"></span><br><span class=\"line\">long_query_time = 5</span><br><span class=\"line\"></span><br><span class=\"line\">slow_query_log_file = /project/mysql/mysql-8.0.18/log/slow.log</span><br><span class=\"line\"></span><br><span class=\"line\">#记录没有索引导致的慢查询</span><br><span class=\"line\"></span><br><span class=\"line\">###连接配置------</span><br><span class=\"line\"></span><br><span class=\"line\">#最大连接数</span><br><span class=\"line\"></span><br><span class=\"line\">max_connections = 3000</span><br><span class=\"line\"></span><br><span class=\"line\">#最大错误连接数</span><br><span class=\"line\"></span><br><span class=\"line\">max_connect_errors = 10</span><br><span class=\"line\"></span><br><span class=\"line\">#连接闲置超时时间</span><br><span class=\"line\"></span><br><span class=\"line\">interactive_timeout = 1800</span><br><span class=\"line\"></span><br><span class=\"line\">wait_timeout = 1800</span><br><span class=\"line\"></span><br><span class=\"line\">#连接响应超时时间</span><br><span class=\"line\"></span><br><span class=\"line\">connect-timeout = 60</span><br><span class=\"line\"></span><br><span class=\"line\">###默认配置（插件、字符------</span><br><span class=\"line\"></span><br><span class=\"line\">default_authentication_plugin = mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\"></span><br><span class=\"line\">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_log_file_size = 1024M</span><br><span class=\"line\"></span><br><span class=\"line\">#关闭InnoDB严格模式，防止报错 Row size too large (&gt; 8126)</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_strict_mode=0</span><br><span class=\"line\"></span><br><span class=\"line\">default-storage-engine=INNODB</span><br><span class=\"line\"></span><br><span class=\"line\">bind-address = 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\">#域名解析，设置为1之后就不能直接127.0.0.1连接数据库，需要root@127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">#skip_name_resolve = 1</span><br><span class=\"line\"></span><br><span class=\"line\">#忽略大小写，此项很重要（MySQL8之后的版本必须在初始化就设定此参数，初始化之后配置更改不生效）</span><br><span class=\"line\"></span><br><span class=\"line\">lower_case_table_names = 1</span><br><span class=\"line\"></span><br><span class=\"line\">###主备相关------</span><br><span class=\"line\"></span><br><span class=\"line\">server-id = 25</span><br><span class=\"line\"></span><br><span class=\"line\">log-bin = backup.log</span><br><span class=\"line\"></span><br><span class=\"line\">#二进制日志格式,三种模式：statement语句&gt;模式,row行模式，mixed混合模式</span><br><span class=\"line\"></span><br><span class=\"line\">binlog_format = mixed</span><br><span class=\"line\"></span><br><span class=\"line\">max_binlog_size = 1G</span><br><span class=\"line\"></span><br><span class=\"line\">expire_logs_days = 7</span><br><span class=\"line\"></span><br><span class=\"line\">#事务提交前产生的日志缓存</span><br><span class=\"line\"></span><br><span class=\"line\">binlog_cache_size = 16M</span><br><span class=\"line\"></span><br><span class=\"line\">#Auto_increment_increment和auto_increment_offset用于主－主服务器（master-to-master）复制，避免主键冲突</span><br><span class=\"line\"></span><br><span class=\"line\">#为了避免两台服务器同时做更新时自增长字段的值之间发生冲突。一般在主主同步配置时，需要将两台服务器的auto_increment_increment增长量都配置为2（根据从库节点数量配置），而要把auto_increment_offset分别配置为1（主库）和2（从库）</span><br><span class=\"line\"></span><br><span class=\"line\">#递增值</span><br><span class=\"line\"></span><br><span class=\"line\">auto_increment_increment = 2</span><br><span class=\"line\"></span><br><span class=\"line\">#初始值</span><br><span class=\"line\"></span><br><span class=\"line\">auto_increment_offset = 1</span><br><span class=\"line\"></span><br><span class=\"line\">#表示需要记录二进制日志的数据库</span><br><span class=\"line\"></span><br><span class=\"line\">binlog_do_db=cssp</span><br><span class=\"line\"></span><br><span class=\"line\">binlog_do_db=mysql</span><br><span class=\"line\"></span><br><span class=\"line\">#从库配置</span><br><span class=\"line\"></span><br><span class=\"line\">replicate_do_db=cssp</span><br><span class=\"line\"></span><br><span class=\"line\">#表示不需要记录二进制日志的数据库</span><br><span class=\"line\"></span><br><span class=\"line\">binlog_ignore_db=information_schema</span><br><span class=\"line\"></span><br><span class=\"line\">#忽略表</span><br><span class=\"line\"></span><br><span class=\"line\">replicate-wild-ignore-table=pva_db.pva_login_%</span><br><span class=\"line\"></span><br><span class=\"line\">replicate-wild-ignore-table=pva_db.pva_login_log</span><br><span class=\"line\"></span><br><span class=\"line\">#忽略错误代码（从库配置）</span><br><span class=\"line\"></span><br><span class=\"line\">slave-skip-errors = 1032,1062,126,1114,1146,1048,1396</span><br><span class=\"line\"></span><br><span class=\"line\">#自动清空不再需要中继日志（从库配置）</span><br><span class=\"line\"></span><br><span class=\"line\">relay-log-purge = 1</span><br><span class=\"line\"></span><br><span class=\"line\">###系统资源相关------</span><br><span class=\"line\"></span><br><span class=\"line\">#接收连接请求队列</span><br><span class=\"line\"></span><br><span class=\"line\">back_log = 600</span><br><span class=\"line\"></span><br><span class=\"line\">#最大打开文件数（前提mysql用户需要调整最大打开文件数）</span><br><span class=\"line\"></span><br><span class=\"line\">open_files_limit = 10240</span><br><span class=\"line\"></span><br><span class=\"line\">#所有线程打开表数量</span><br><span class=\"line\"></span><br><span class=\"line\">table_open_cache = 512</span><br><span class=\"line\"></span><br><span class=\"line\">#处理请求包最大大小</span><br><span class=\"line\"></span><br><span class=\"line\">max_allowed_packet = 32M</span><br><span class=\"line\"></span><br><span class=\"line\">#临时表最大大小</span><br><span class=\"line\"></span><br><span class=\"line\">tmp_table_size = 512M</span><br><span class=\"line\"></span><br><span class=\"line\">#独立内存表所允许最大容量</span><br><span class=\"line\"></span><br><span class=\"line\">max_heap_table_size = 512M</span><br><span class=\"line\"></span><br><span class=\"line\">#用于索引块的缓冲区大小</span><br><span class=\"line\"></span><br><span class=\"line\">key_buffer_size = 64M</span><br><span class=\"line\"></span><br><span class=\"line\">#查询排序的缓冲区大小</span><br><span class=\"line\"></span><br><span class=\"line\">sort_buffer_size = 8M</span><br><span class=\"line\"></span><br><span class=\"line\">#读操作的缓冲区大小</span><br><span class=\"line\"></span><br><span class=\"line\">read_buffer_size = 8M</span><br><span class=\"line\"></span><br><span class=\"line\">#联表查询缓冲区大小</span><br><span class=\"line\"></span><br><span class=\"line\">join_buffer_size = 8M</span><br><span class=\"line\"></span><br><span class=\"line\">#批量数据插入缓存</span><br><span class=\"line\"></span><br><span class=\"line\">bulk_insert_buffer_size = 120M</span><br><span class=\"line\"></span><br><span class=\"line\">#保存索引以及原始数据的缓冲池（原则上最大为系统内存的 80%）</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_buffer_pool_size = 2G</span><br><span class=\"line\"></span><br><span class=\"line\">#脏页比例，脏页占innodb_buffer_pool_size的比例时，触发刷脏页到磁盘（25~50）</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_max_dirty_pages_pct = 30</span><br><span class=\"line\"></span><br><span class=\"line\">#事务提交 flush</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_flush_log_at_trx_commit = 1</span><br><span class=\"line\"></span><br><span class=\"line\">#1，（默认值）每一次提交刷新日志到磁盘</span><br><span class=\"line\"></span><br><span class=\"line\">#2，先写入缓存，由系统设置每秒刷新日志到磁盘（可能丢失1~2秒的数据）</span><br><span class=\"line\"></span><br><span class=\"line\">###多线程优化------</span><br><span class=\"line\"></span><br><span class=\"line\">#可重新被利用保存在缓存中的线程数量</span><br><span class=\"line\"></span><br><span class=\"line\">thread_cache_size = 300</span><br><span class=\"line\"></span><br><span class=\"line\">###其他配置------</span><br><span class=\"line\"></span><br><span class=\"line\">#占用内存过高调整以下参数配置</span><br><span class=\"line\"></span><br><span class=\"line\">#table_definition_cache = 400</span><br><span class=\"line\"></span><br><span class=\"line\">#open_files_limit = 2048</span><br><span class=\"line\"></span><br><span class=\"line\">#table_open_cache = 256</span><br><span class=\"line\"></span><br><span class=\"line\">#跳过密码表检查</span><br><span class=\"line\"></span><br><span class=\"line\">#skip-grant-tables</span><br></pre></td></tr></table></figure>\n\n<p>修改了配置文件需要重启MySQL服务实例重新加载。</p>\n<h2 id=\"内置数据库\"><a href=\"#内置数据库\" class=\"headerlink\" title=\"内置数据库\"></a><a href=\"#%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93\">内置数据库</a></h2><ul>\n<li><p><strong>mysql</strong>：这个库很重要，他是mysql的核心数据库，负责存储数据库的用户、权限设置、关键字等mysql自己需要使用，控制和管理的信息。</p>\n</li>\n<li><p><strong>information_schema</strong>：这个数据库维护了数据库其他表的一些描述性信息，也称为元数据。比如，当前有哪</p>\n</li>\n</ul>\n<p>些表，哪些视图，哪些触发器，哪些列等。</p>\n<ul>\n<li><strong>performation_schema</strong>：这个数据库用来存储mysql服务器运行过程中的一些状态信息，是做性能监控的。</li>\n</ul>\n<p>比如最近执行了什么sql语句，内存使用情况等</p>\n<ul>\n<li><strong>sys</strong>：结合information_schema和performation_schema的数据，能更方便的了解mysql服务器的性能信</li>\n</ul>\n<p>息。</p>\n<hr>\n<p>2024.11.05</p>\n<p>writeBy kaiven</p>\n","text":"MySQL的系统架构1、数据库和数据库实例在与MySQL相关的学习和研究中，我们需要搞清楚一些概念： 数据库：按照一定的数据结构来组织、存储和管理数据的仓库，通...","permalink":"/post/mysql进阶","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"八股","slug":"八股","count":14,"path":"api/categories/八股.json"}],"tags":[{"name":"mysql","slug":"mysql","count":1,"path":"api/tags/mysql.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MySQL%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">MySQL的系统架构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B\"><span class=\"toc-text\">1、数据库和数据库实例</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2%E3%80%81MySQL%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">2、MySQL架构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%881%EF%BC%89MySQL%E5%90%91%E5%A4%96%E6%8F%90%E4%BE%9B%E7%9A%84%E4%BA%A4%E4%BA%92%E6%8E%A5%E5%8F%A3\"><span class=\"toc-text\">（1）MySQL向外提供的交互接口</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%882%EF%BC%89%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6%E5%92%8C%E5%B7%A5%E5%85%B7%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（2）管理服务组件和工具组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%883%EF%BC%89%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（3）连接池组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%884%EF%BC%89SQL%E6%8E%A5%E5%8F%A3%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（4）SQL接口组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%885%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90%E5%99%A8%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（5）查询分析器组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%886%EF%BC%89%E4%BC%98%E5%8C%96%E5%99%A8%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（6）优化器组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%887%EF%BC%89%E7%BC%93%E5%AD%98%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">（7）缓存组件</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%EF%BC%888%EF%BC%89MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E\"><span class=\"toc-text\">（8）MySQL存储引擎</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3%E3%80%81SQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">3、SQL语句的执行流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E9%97%AE%E9%A2%98%EF%BC%9AMySQL8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E6%B6%88%E4%BA%86%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%EF%BC%9F\"><span class=\"toc-text\">小问题：MySQL8为什么取消了查询缓存？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MySQL%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">MySQL的目录结构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#windows%E4%B8%AD%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">windows中的目录结构</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Linux%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">Linux中的文件目录</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99\"><span class=\"toc-text\">字符集和排序规则</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MySQL%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">MySQL修改配置的方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1%E3%80%81%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">1、修改全局变量</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2%E3%80%81%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D%E7%9A%84%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">2、当前会话的变量</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3%E3%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">3、修改配置文件</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">内置数据库</span></a></li></ol>","author":{"name":"Ivan","slug":"blog-author","avatar":"https://yslcrush.obs.cn-south-1.myhuaweicloud.com/imag/m.jpg","link":"/","description":"离婚后看淡人生","socials":{"github":"https://github.com/FAKERSMILE","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/3494374914656981/favlist"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"java导学","uid":"5d0fb8fa16015e90389a3f31d7e8667c","slug":"java导学","date":"2024-12-03T13:13:19.000Z","updated":"2024-12-03T16:35:43.385Z","comments":true,"path":"api/articles/java导学.json","keywords":null,"cover":"https://i.pinimg.com/474x/a0/3f/5c/a03f5c2ed311ca2f8fdd62915f30d933.jpg","text":"恭喜你，成功入坑Java开发，以后将走上后端开发的道路。 Java是一门什么样的编程语言呢？ （AI的回答） Java 是一种广泛使用的编程语言，它由Sun M...","permalink":"/post/java导学","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"八股","slug":"八股","count":14,"path":"api/categories/八股.json"}],"tags":[{"name":"java","slug":"java","count":12,"path":"api/tags/java.json"},{"name":"java基础","slug":"java基础","count":1,"path":"api/tags/java基础.json"}],"author":{"name":"Ivan","slug":"blog-author","avatar":"https://yslcrush.obs.cn-south-1.myhuaweicloud.com/imag/m.jpg","link":"/","description":"离婚后看淡人生","socials":{"github":"https://github.com/FAKERSMILE","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/3494374914656981/favlist"}}}}},"next_post":{"title":"面试官到底喜欢什么样的人？","uid":"76e26cf6d70a50daf8e75fb7d566964d","slug":"面试","date":"2024-12-03T12:35:49.000Z","updated":"2024-12-03T12:35:07.715Z","comments":true,"path":"api/articles/面试.json","keywords":null,"cover":"https://i.pinimg.com/474x/8f/99/70/8f99709dfeb5287cc9126fbb64a99b2e.jpg","text":"面试官到底喜欢什么样的人？在统一批次的面试中，可能就有好几百号人，无可否认的是，我们都喜欢优秀的人，都想和优秀的人共事，那怎么表现出我们的优秀呢？ 面试官喜欢爱...","permalink":"/post/面试","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"面试","slug":"面试","count":1,"path":"api/tags/面试.json"}],"author":{"name":"Ivan","slug":"blog-author","avatar":"https://yslcrush.obs.cn-south-1.myhuaweicloud.com/imag/m.jpg","link":"/","description":"离婚后看淡人生","socials":{"github":"https://github.com/FAKERSMILE","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/3494374914656981/favlist"}}}}}}